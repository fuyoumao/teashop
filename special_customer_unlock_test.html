<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰¹æ®Šé¡¾å®¢è§£é”æµç¨‹æµ‹è¯•</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #7c4f3f 0%, #a0756b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .customer-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .customer-section:hover {
            border-color: #7c4f3f;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 79, 63, 0.15);
        }
        
        .customer-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #7c4f3f;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .customer-name {
            font-size: 18px;
            font-weight: 600;
            color: #7c4f3f;
            margin-bottom: 8px;
        }
        
        .recipe-name {
            font-size: 16px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .visit-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
        }
        
        .visit-count {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .unlock-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .status-locked {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-unlocked {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .test-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            background: #7c4f3f;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 100px;
        }
        
        .test-btn:hover {
            background: #6a4334;
            transform: translateY(-1px);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .test-btn.disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .control-section {
            border-top: 1px solid #eee;
            padding: 30px;
            background: #fafbfc;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .control-btn.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }
        
        .control-btn.danger:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .log-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .log-header {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .log-content {
            height: 250px;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .log-time {
            color: #666;
            margin-right: 10px;
        }
        
        .log-type-info {
            color: #0066cc;
        }
        
        .log-type-success {
            color: #00cc66;
            font-weight: 600;
        }
        
        .log-type-warning {
            color: #ff8800;
        }
        
        .log-type-error {
            color: #cc0000;
        }
        
        /* æ•…äº‹å¼¹çª—æ ·å¼ */
        .recipe-unlock-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: unlock-panel-appear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(10px);
        }
        
        @keyframes unlock-panel-appear {
            from { 
                opacity: 0; 
                transform: translate(-50%, -60%) scale(0.8); 
            }
            to { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1); 
            }
        }
        
        .unlock-header {
            padding: 20px 25px 15px;
            background: linear-gradient(135deg, #7c4f3f 0%, #a0756b 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .unlock-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: white;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .close-btn:hover {
            opacity: 1;
        }
        
        .unlock-content {
            padding: 25px;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .unlock-image {
            font-size: 60px;
            text-align: center;
            margin-bottom: 20px;
            animation: tea-bounce 2s ease-in-out infinite;
        }
        
        @keyframes tea-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .unlock-title {
            font-size: 26px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            color: #7c4f3f;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .unlock-story {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 25px;
            color: #333;
            text-align: justify;
            padding: 0 5px;
            text-indent: 2em;
        }
        
        .unlock-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #7c4f3f, transparent);
            margin: 20px 0;
        }
        
        .unlock-info {
            font-size: 15px;
            color: #555;
            line-height: 1.6;
        }
        
        .unlock-effect, .unlock-ingredients {
            margin-bottom: 12px;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #7c4f3f;
        }
        
        .unlock-footer {
            padding: 20px 25px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        .confirm-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #7c4f3f 0%, #a0756b 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(124, 79, 63, 0.3);
        }
        
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 79, 63, 0.4);
        }
        
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1999;
            animation: overlay-appear 0.3s ease-out;
        }
        
        @keyframes overlay-appear {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
                padding: 20px;
                gap: 20px;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .recipe-unlock-panel {
                width: 95%;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸµ ç‰¹æ®Šé¡¾å®¢è§£é”æµç¨‹æµ‹è¯•</h1>
            <p>æµ‹è¯•ç‰¹æ®Šé¡¾å®¢è§£é”é…æ–¹çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æ¦‚ç‡æœºåˆ¶å’Œæ•…äº‹å¼¹çª—</p>
        </div>
        
        <div class="test-grid">
            <div class="customer-section">
                <h3 style="margin-top: 0; color: #7c4f3f; font-size: 20px;">â­ å¿…å®šè§£é” (1-2æ¬¡)</h3>
                <div id="guaranteed-customers"></div>
            </div>
            
            <div class="customer-section">
                <h3 style="margin-top: 0; color: #7c4f3f; font-size: 20px;">ğŸ² æ¦‚ç‡è§£é” (2-5æ¬¡)</h3>
                <div id="probability-customers"></div>
            </div>
        </div>
        
        <div class="control-section">
            <div class="control-grid">
                <button class="control-btn" onclick="testAllCustomersOnce()">
                    ğŸ§ª æ‰¹é‡æµ‹è¯• - æ‰€æœ‰é¡¾å®¢æ¥è®¿1æ¬¡
                </button>
                <button class="control-btn" onclick="showRandomStory()">
                    ğŸ“– éšæœºæ˜¾ç¤ºæ•…äº‹
                </button>
                <button class="control-btn danger" onclick="resetAllProgress()">
                    ğŸ”„ é‡ç½®æ‰€æœ‰è¿›åº¦
                </button>
            </div>
            
            <div class="log-section">
                <div class="log-header">ğŸ“‹ æµ‹è¯•æ—¥å¿—</div>
                <div class="log-content" id="test-log"></div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç”¨çš„æ¸¸æˆæ•°æ®
        const testGameData = {
            unlockedRecipes: ["äº”å‘³å­é¥®", "æŸ æª¬èŒ¶"],
            customerVisits: {},
            shownRecipeStories: [],
            
            // è§£é”è§„åˆ™
            recipeUnlockRules: {
                "æ´›ç¥ç«ç‘°é¥®": { customer: "å‡Œå°è·¯", visitsRequired: 1, chance: 1.0, guaranteedOnVisit: 1 },
                "æ¡‚åœ†çº¢æ£èŒ¶": { customer: "èŠ±èŠ±", visitsRequired: 1, chance: 1.0, guaranteedOnVisit: 1 },
                "ç„¦é¦™å¤§éº¦èŒ¶": { customer: "æ±Ÿé£é£", visitsRequired: 2, chance: 1.0, guaranteedOnVisit: 2 },
                "ä¸‰èŠ±å†³æ˜èŒ¶": { customer: "æ±Ÿä¸‰", visitsRequired: 2, chance: 1.0, guaranteedOnVisit: 2 },
                "è–„è·ç”˜è‰å‡‰èŒ¶": { customer: "æ±Ÿå››", visitsRequired: 2, chance: 1.0, guaranteedOnVisit: 2 },
                "é™ˆçš®å§œç±³èŒ¶": { customer: "æ± äº‘æ——", visitsRequired: 2, chance: 0.5, guaranteedOnVisit: 3 },
                "å†¬ç“œè·å¶é¥®": { customer: "æ±Ÿæ½®", visitsRequired: 3, chance: 0.6, guaranteedOnVisit: 4 },
                "å¤æ³•é…¸æ¢…æ±¤": { customer: "æ± æƒŠæš®", visitsRequired: 2, chance: 0.3, guaranteedOnVisit: 3 },
                "å°åŠæ¢¨æ±¤": { customer: "æ±Ÿæ••å°", visitsRequired: 3, chance: 0.4, guaranteedOnVisit: 5 }
            },
            
            // æ•…äº‹æ•°æ®
            recipeStories: {
                "æ´›ç¥ç«ç‘°é¥®": {
                    customer: "å‡Œå°è·¯",
                    title: "æœ±ç ‚",
                    story: "å‡Œå°è·¯è¢–ä¸­è—ç€ä¸€ç›æ¸©çƒ­çš„æ´›ç¥ç«ç‘°é¥®ã€‚'ç–è‚è§£éƒçš„ï¼Œå¥½å¥½å­¦å­¦ï¼Œé£é£æ¥äº†å°±åšç»™ä»–ã€‚è·Ÿä»–è¯´å°±è¯´å…»é¢œçš„èŒ¶æ–¹å­'æŒ‘çœ‰ç¬‘æ—¶ï¼Œçœ¼åº•å´æ˜ ç€åˆ€å…‰ï¼Œè¢è§’è¿˜æ²¾ç€è¡€ã€‚",
                    effect: "ç–è‚è§£éƒï¼Œç¾ç™½å…»é¢œï¼Œæ´»è¡€è°ƒç»ï¼Œé€‚åˆå¥³å­æ—¥å¸¸é¥®ç”¨"
                },
                "æ¡‚åœ†çº¢æ£èŒ¶": {
                    customer: "èŠ±èŠ±",
                    title: "æ— å½’",
                    story: "èŠ±èŠ±å»å‡Œé›ªåŸå‰æ‰«å¢“ï¼Œæ‰‹é‡Œæ‹¿ç€ä»–æœ€å–œæ¬¢å¥¹ç»™ä»–åšçš„èŒ¶ã€‚åªæ˜¯è¿™ä¸€æ¬¡åªèƒ½è‡ªå·±åšäº†ã€‚'è‡ªå·±ç»™è‡ªå·±ä½œèŒ¶æ€ä¹ˆè¡Œï¼Œè¿™æ–¹å­ç»™ä½ ä»¬ï¼Œä»¥åæˆ‘å°±æ¥è¿™é‡Œå–å§'",
                    effect: "è¡¥è¡€ç›Šæ°”ï¼Œå®‰ç¥å…»å¿ƒï¼Œæ»‹é˜´æ¶¦ç‡¥ï¼Œé€‚åˆä½“å¼±æˆ–ç†¬å¤œè€…é¥®ç”¨"
                },
                "ç„¦é¦™å¤§éº¦èŒ¶": {
                    customer: "æ±Ÿé£é£",
                    title: "é›ªå¤œ",
                    story: "é•¿å®‰å†¬å¤œï¼Œæ±Ÿé£é£èœ·åœ¨å‡Œé›ªé˜çš„å±‹æªä¸Šï¼ŒæŒ‡å°–å†»å¾—å‘åƒµã€‚æ±Ÿä¸‰ç¿»ä¸Šå±‹é¡¶ï¼Œæ‰”æ¥ä¸€å£¶æ»šçƒ«çš„å¤§éº¦èŒ¶ï¼š'æ€‚æ ·ï¼Œå–ä¸¤å£ã€‚'èŒ¶é›¾æ°¤æ°²é‡Œï¼Œä»–å¿½ç„¶æƒ³èµ·å¹¼æ—¶ç¬¬ä¸€æ¬¡æ¡åˆ€ï¼Œä¹Ÿæ˜¯è¿™ç„¦è‹¦çš„ç”œé¦™å‹ä½äº†é¢¤æŠ–ã€‚",
                    effect: "æš–èƒƒæ¶ˆé£Ÿï¼Œç¼“è§£ç„¦è™‘ï¼Œå®‰å®šå¿ƒç¥ï¼Œé€‚åˆç§‹å†¬é¥®ç”¨"
                },
                "ä¸‰èŠ±å†³æ˜èŒ¶": {
                    customer: "æ±Ÿä¸‰",
                    title: "å¤œç‹©",
                    story: "æ±Ÿå››æ‰§åˆ€å½’æ¥ï¼Œè§æ±Ÿä¸‰ä¼æ¡ˆçŒç¡ï¼Œæ‰‹è¾¹ä¸€ç›å‡‰é€çš„ä¸‰èŠ±å†³æ˜èŒ¶ã€‚ä»–è½»å¹ï¼Œå°†å¤–è¢æŠ«ä¸Šå…„é•¿è‚©å¤´â€”â€”å´ä¸çŸ¥æ˜¨å¤œè‡ªå·±ä»»åŠ¡å•ä¸Šé‚£ä¸‰ä¸ªåå­—ï¼Œæ—©å·²è¢«æ±Ÿä¸‰çš„è¡€åˆƒåˆ’å»ã€‚èŒ¶æ¸£æ²‰åº•ï¼Œå¦‚æœªæ„ˆçš„æ—§ä¼¤ã€‚",
                    effect: "æ¸…è‚æ˜ç›®ï¼Œæ¸…çƒ­è§£æ¯’ï¼Œç¼“è§£çœ¼ç–²åŠ³ï¼Œé€‚åˆé•¿æœŸä¼æ¡ˆæˆ–å¤œè§†è€…é¥®ç”¨"
                },
                "è–„è·ç”˜è‰å‡‰èŒ¶": {
                    customer: "æ±Ÿå››",
                    title: "ä¸‰å“¥",
                    story: "æ±Ÿå››ç»™æ±Ÿä¸‰æ³¡çš„èŒ¶ï¼Œæ¸…æ¸…å‡‰å‡‰çš„ï¼Œä»–é‚£ä¹ˆçˆ±å‡ºæ±—ï¼Œè‚¯å®šå–œæ¬¢ã€‚èŒ¶å¶åˆšæ”¾ä¸‹ï¼Œå°±å¬åˆ°ä¸‰å“¥åœ¨é™¢å­é‡Œè®­ç»ƒçš„åˆ€å£°ï¼Œä»–æ‚„æ‚„æ¢å¤´çœ‹äº†ä¸€çœ¼ï¼Œå†³å®šåŠ å¤šä¸€ç‰‡è–„è·å¶ã€‚",
                    effect: "æ¸…çƒ­è§£æš‘ï¼Œæ¶¦å–‰æ­¢å’³ï¼Œæç¥é†’è„‘ï¼Œé€‚åˆå¤å­£é¥®ç”¨"
                },
                "é™ˆçš®å§œç±³èŒ¶": {
                    customer: "æ± äº‘æ——",
                    title: "å¸ˆå¾’",
                    story: "æ± äº‘æ——å¿ƒç–¼é‚£å°å®¶ä¼™ï¼Œä»¥å‰ä¹Ÿä¸æ‡‚è‡ªå·±ç…§é¡¾è‡ªå·±ï¼Œè¿™èŒ¶æ˜¯å¥¹ä¸“é—¨ç»™ä»–æ‰¾åŒ»å¸ˆæŠ„çš„æ–¹å­ã€‚'åˆ«æ€»åƒé‚£äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œèƒƒç–¼äº†å¯åˆ«æ¥æ‰¾å¸ˆçˆ¶'è™½ç„¶å˜´ä¸Šè¿™ä¹ˆè¯´ï¼Œå¥¹è¿˜æ˜¯æ‚„æ‚„åœ¨èŒ¶é‡Œå¤šåŠ äº†ä¸€ç‰‡é™ˆçš®ã€‚",
                    effect: "å¥è„¾å’Œèƒƒï¼Œç†æ°”åŒ–ç—°ï¼Œæ¸©ä¸­æ•£å¯’ï¼Œé€‚åˆæ¶ˆåŒ–ä¸è‰¯æˆ–èƒƒå¯’è€…é¥®ç”¨"
                },
                "å†¬ç“œè·å¶é¥®": {
                    customer: "æ±Ÿæ½®",
                    title: "å¸ˆå¾’2",
                    story: "æ±Ÿæ½®ç»™å¸ˆçˆ¶å¼„çš„æ¶ˆæš‘èŒ¶ï¼Œè·å¶æ˜¯è‡ªå·±è¶´åœ¨æ± å¡˜è¾¹é‡‡çš„ï¼Œå†¬ç“œä¹Ÿæ˜¯è‡ªå·±ç§çš„ã€‚'å¸ˆçˆ¶ï¼Œæ‚¨å°å°ï¼Œæˆ‘æŒ‰ç…§æ‚¨è¯´çš„æ–¹æ³•åšçš„'ä»–å°å¿ƒç¿¼ç¿¼åœ°ç«¯ç€èŒ¶ï¼Œç”Ÿæ€•å¸ˆçˆ¶ä¸å–œæ¬¢ï¼Œå´ä¸çŸ¥é“æ± äº‘æ——æ—©å·²æ¬£æ…°åœ°ç¬‘äº†ã€‚",
                    effect: "æ¸…çƒ­åˆ©æ¹¿ï¼Œæ¶ˆè‚¿å‡è„‚ï¼Œç¾å®¹å…»é¢œï¼Œé€‚åˆå¤å­£æ¶ˆæš‘æˆ–å‡è‚¥è€…é¥®ç”¨"
                },
                "å¤æ³•é…¸æ¢…æ±¤": {
                    customer: "æ± æƒŠæš®",
                    title: "æ¢…é¦™",
                    story: "é•¿å®‰æš‘å¤œï¼Œæ± æƒŠæš®æ‰§å‰‘ä¼äºå±‹è„Šã€‚ç›®æ ‡å‡ºç°æ—¶ï¼Œå¥¹æ­£é¥®å°½æœ€åä¸€æ»´é…¸æ¢…æ±¤ã€‚ç“·ç¢—å åœ°ç¢å“æ··ç€å–‰éª¨æ–­è£‚å£°ï¼Œæ¢…å¦ƒæ•™çš„å°æ–¹å­â€”â€”æ€äººæ—¶å”‡é½¿é—´è¯¥ç•™ç€ç”œå‘³ï¼Œæ‰ä¸è‹¦ã€‚",
                    effect: "ç”Ÿæ´¥æ­¢æ¸´ï¼Œæ¶ˆæš‘è§£è…»ï¼Œå¥è„¾å¼€èƒƒï¼Œç¼“è§£ç‡¥çƒ­ï¼Œå”ä»£å·²æ˜¯å®«å»·æ¶ˆæš‘ä½³é¥®"
                },
                "å°åŠæ¢¨æ±¤": {
                    customer: "æ±Ÿæ••å°",
                    title: "ç´å¿ƒ",
                    story: "æ±Ÿæ••å°æŠšç´æ—¶æ€»çˆ±åœ¨èº«è¾¹æ”¾ä¸€ç›å°åŠæ¢¨æ±¤ï¼Œç´å£°æ‚ æ‰¬ï¼ŒèŒ¶é¦™è¢…è¢…ã€‚ä»–è¯´ç´å¦‚äººç”Ÿï¼Œéœ€è¦æ…¢æ…¢è°ƒæ•™ï¼›èŒ¶å¦‚å¿ƒå¢ƒï¼Œéœ€è¦ç»†ç»†å“å‘³ã€‚ä¸€æ›²ç»ˆäº†ï¼Œä¸€ç›èŒ¶å°½ï¼Œéƒ½æ˜¯è¿™ä¸–é—´æœ€æ¸©æŸ”çš„æ—¶å…‰ã€‚",
                    effect: "æ¶¦è‚ºæ­¢å’³ï¼Œæ¸…çƒ­é™ç«ï¼Œæ»‹é˜´ç¾å®¹ï¼Œå®«å»·ä¼ ç»Ÿæ»‹è¡¥ä½³å“"
                }
            },
            
            // é…æ–¹ææ–™ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
            recipeIngredients: {
                "æ´›ç¥ç«ç‘°é¥®": ["æ´›ç¥èŠ±", "ç«ç‘°èŠ±", "å±±æ¥‚"],
                "æ¡‚åœ†çº¢æ£èŒ¶": ["æ¡‚åœ†", "çº¢æ£", "æ¸æ"],
                "ç„¦é¦™å¤§éº¦èŒ¶": ["å¤§éº¦"],
                "ä¸‰èŠ±å†³æ˜èŒ¶": ["èŠèŠ±", "é‡‘é“¶èŠ±", "å†³æ˜å­", "æ¸æ"],
                "è–„è·ç”˜è‰å‡‰èŒ¶": ["è–„è·", "ç”˜è‰"],
                "é™ˆçš®å§œç±³èŒ¶": ["é™ˆçš®", "ç”Ÿå§œ"],
                "å†¬ç“œè·å¶é¥®": ["å†¬ç“œ", "è·å¶", "è–ç±³"],
                "å¤æ³•é…¸æ¢…æ±¤": ["ä¹Œæ¢…", "å±±æ¥‚", "é™ˆçš®", "ç”˜è‰", "æ¡‚èŠ±"],
                "å°åŠæ¢¨æ±¤": ["é›ªèŠ±æ¢¨", "é“¶è€³", "è¯æ¢…", "æ¸æ"]
            }
        };
        
        // æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-type-${type}">${message}</span>
            `;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // é¡¾å®¢æ¥è®¿æµ‹è¯•
        function testCustomerVisit(customerName) {
            log(`ğŸƒ ${customerName} æ¥åˆ°èŒ¶é“º`, 'info');
            
            // å¢åŠ æ¥è®¿æ¬¡æ•°
            if (!testGameData.customerVisits[customerName]) {
                testGameData.customerVisits[customerName] = 1;
            } else {
                testGameData.customerVisits[customerName]++;
            }
            
            const visitCount = testGameData.customerVisits[customerName];
            log(`${customerName} å·²æ¥è®¿ ${visitCount} æ¬¡`, 'info');
            
            // æ£€æŸ¥è§£é”
            const unlocked = checkRecipeUnlock(customerName);
            if (!unlocked) {
                log(`âŒ æš‚æœªè§£é”æ–°é…æ–¹`, 'warning');
            }
            
            updateCustomerDisplay();
        }
        
        // æ£€æŸ¥é…æ–¹è§£é”
        function checkRecipeUnlock(customerName) {
            const visitCount = testGameData.customerVisits[customerName] || 0;
            let unlockedRecipe = null;
            
            Object.entries(testGameData.recipeUnlockRules).forEach(([recipe, rule]) => {
                if (rule.customer === customerName) {
                    if (testGameData.unlockedRecipes.includes(recipe)) {
                        return;
                    }
                    
                    if (visitCount >= rule.visitsRequired) {
                        let shouldUnlock = false;
                        
                        if (visitCount >= rule.guaranteedOnVisit) {
                            shouldUnlock = true;
                            log(`ğŸ¯ è¾¾åˆ°ä¿åº•æ¬¡æ•° ${rule.guaranteedOnVisit}ï¼Œå¿…å®šè§£é”`, 'info');
                        } else {
                            const random = Math.random();
                            if (random < rule.chance) {
                                shouldUnlock = true;
                                log(`ğŸ² æ¦‚ç‡è§£é”æˆåŠŸ (${(rule.chance * 100).toFixed(0)}%ï¼Œéšæœºå€¼: ${random.toFixed(3)})`, 'info');
                            } else {
                                log(`ğŸ² æ¦‚ç‡è§£é”å¤±è´¥ (${(rule.chance * 100).toFixed(0)}%ï¼Œéšæœºå€¼: ${random.toFixed(3)})`, 'warning');
                            }
                        }
                        
                        if (shouldUnlock) {
                            unlockedRecipe = recipe;
                        }
                    } else {
                        log(`âŒ è®¿é—®æ¬¡æ•°ä¸è¶³ (éœ€è¦${rule.visitsRequired}æ¬¡ï¼Œå½“å‰${visitCount}æ¬¡)`, 'warning');
                    }
                }
            });
            
            if (unlockedRecipe) {
                log(`ğŸ‰ è§£é”é…æ–¹: ${unlockedRecipe}`, 'success');
                testGameData.unlockedRecipes.push(unlockedRecipe);
                
                // å»¶è¿Ÿæ˜¾ç¤ºæ•…äº‹ï¼Œæ¨¡æ‹ŸçœŸå®æ¸¸æˆä½“éªŒ
                setTimeout(() => {
                    showRecipeUnlockStory(unlockedRecipe);
                }, 1000);
                
                return true;
            }
            
            return false;
        }
        
        // æ˜¾ç¤ºé…æ–¹è§£é”æ•…äº‹
        function showRecipeUnlockStory(recipe) {
            const storyData = testGameData.recipeStories[recipe];
            if (!storyData) {
                log(`âŒ æ‰¾ä¸åˆ°é…æ–¹ ${recipe} çš„æ•…äº‹æ•°æ®`, 'error');
                return;
            }
            
            log(`ğŸ“– æ˜¾ç¤ºæ•…äº‹: "${storyData.title}" - ${recipe}`, 'success');
            
            // åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.className = 'panel-overlay';
            document.body.appendChild(overlay);
            
            // åˆ›å»ºæ•…äº‹é¢æ¿
            const storyPanel = document.createElement('div');
            storyPanel.className = 'recipe-unlock-panel';
            storyPanel.innerHTML = `
                <div class="unlock-header">
                    <h3>è§£é”æ–°é…æ–¹: ${recipe}</h3>
                    <button class="close-btn">Ã—</button>
                </div>
                <div class="unlock-content">
                    <div class="unlock-image">ğŸµ</div>
                    <div class="unlock-title">${storyData.title}</div>
                    <div class="unlock-story">${storyData.story}</div>
                    <div class="unlock-divider"></div>
                    <div class="unlock-info">
                        <div class="unlock-effect"><b>åŠŸæ•ˆ:</b> ${storyData.effect}</div>
                        <div class="unlock-ingredients"><b>ææ–™:</b> ${testGameData.recipeIngredients[recipe].join('ã€')}</div>
                    </div>
                </div>
                <div class="unlock-footer">
                    <button class="confirm-btn">æˆ‘å·²äº†è§£</button>
                </div>
            `;
            
            document.body.appendChild(storyPanel);
            
            // æ·»åŠ å…³é—­åŠŸèƒ½
            const closePanel = () => {
                storyPanel.remove();
                overlay.remove();
                log(`âœ… æ•…äº‹é¢æ¿å·²å…³é—­`, 'info');
            };
            
            storyPanel.querySelector('.close-btn').addEventListener('click', closePanel);
            storyPanel.querySelector('.confirm-btn').addEventListener('click', closePanel);
            overlay.addEventListener('click', closePanel);
        }
        
        // æ›´æ–°é¡¾å®¢æ˜¾ç¤º
        function updateCustomerDisplay() {
            updateCustomerSection('guaranteed-customers', ['å‡Œå°è·¯', 'èŠ±èŠ±', 'æ±Ÿé£é£', 'æ±Ÿä¸‰', 'æ±Ÿå››']);
            updateCustomerSection('probability-customers', ['æ± äº‘æ——', 'æ±Ÿæ½®', 'æ± æƒŠæš®', 'æ±Ÿæ••å°']);
        }
        
        function updateCustomerSection(sectionId, customers) {
            const section = document.getElementById(sectionId);
            section.innerHTML = '';
            
            customers.forEach(customerName => {
                const rule = Object.entries(testGameData.recipeUnlockRules).find(([recipe, rule]) => rule.customer === customerName);
                if (!rule) return;
                
                const [recipeName, ruleData] = rule;
                const visitCount = testGameData.customerVisits[customerName] || 0;
                const isUnlocked = testGameData.unlockedRecipes.includes(recipeName);
                
                const card = document.createElement('div');
                card.className = 'customer-card';
                
                let unlockInfo = '';
                if (ruleData.chance < 1.0) {
                    unlockInfo = `ç¬¬${ruleData.visitsRequired}æ¬¡èµ· ${(ruleData.chance * 100).toFixed(0)}% æ¦‚ç‡ï¼Œç¬¬${ruleData.guaranteedOnVisit}æ¬¡å¿…å®šè§£é”`;
                } else {
                    unlockInfo = `ç¬¬${ruleData.visitsRequired}æ¬¡å¿…å®šè§£é”`;
                }
                
                card.innerHTML = `
                    <div class="customer-name">${customerName}</div>
                    <div class="recipe-name">ğŸµ ${recipeName}</div>
                    <div class="visit-count">æ¥è®¿æ¬¡æ•°: ${visitCount}</div>
                    <div class="unlock-status ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                        ${isUnlocked ? 'âœ… å·²è§£é”' : 'ğŸ”’ æœªè§£é”'}
                    </div>
                    <div class="visit-info">${unlockInfo}</div>
                    <div class="test-buttons">
                        <button class="test-btn" onclick="testCustomerVisit('${customerName}')">
                            æ¥è®¿ä¸€æ¬¡
                        </button>
                        <button class="test-btn" onclick="testMultipleVisits('${customerName}', 3)">
                            æ¥è®¿3æ¬¡
                        </button>
                        ${isUnlocked ? 
                            `<button class="test-btn" onclick="showRecipeUnlockStory('${recipeName}')">æŸ¥çœ‹æ•…äº‹</button>` :
                            `<button class="test-btn disabled" disabled>æ•…äº‹æœªè§£é”</button>`
                        }
                    </div>
                `;
                
                section.appendChild(card);
            });
        }
        
        // æµ‹è¯•å¤šæ¬¡æ¥è®¿
        function testMultipleVisits(customerName, times) {
            log(`ğŸ”„ å¼€å§‹è¿ç»­æµ‹è¯• ${customerName} æ¥è®¿ ${times} æ¬¡`, 'info');
            for (let i = 0; i < times; i++) {
                setTimeout(() => {
                    testCustomerVisit(customerName);
                }, i * 500);
            }
        }
        
        // æ‰¹é‡æµ‹è¯•æ‰€æœ‰é¡¾å®¢
        function testAllCustomersOnce() {
            log(`ğŸ§ª å¼€å§‹æ‰¹é‡æµ‹è¯• - æ‰€æœ‰é¡¾å®¢æ¥è®¿1æ¬¡`, 'info');
            const allCustomers = ['å‡Œå°è·¯', 'èŠ±èŠ±', 'æ±Ÿé£é£', 'æ±Ÿä¸‰', 'æ±Ÿå››', 'æ± äº‘æ——', 'æ±Ÿæ½®', 'æ± æƒŠæš®', 'æ±Ÿæ••å°'];
            
            allCustomers.forEach((customer, index) => {
                setTimeout(() => {
                    testCustomerVisit(customer);
                }, index * 800);
            });
        }
        
        // éšæœºæ˜¾ç¤ºæ•…äº‹
        function showRandomStory() {
            const allRecipes = Object.keys(testGameData.recipeStories);
            const randomRecipe = allRecipes[Math.floor(Math.random() * allRecipes.length)];
            log(`ğŸ“– éšæœºæ˜¾ç¤ºæ•…äº‹: ${randomRecipe}`, 'info');
            showRecipeUnlockStory(randomRecipe);
        }
        
        // é‡ç½®æ‰€æœ‰è¿›åº¦
        function resetAllProgress() {
            testGameData.unlockedRecipes = ["äº”å‘³å­é¥®", "æŸ æª¬èŒ¶"];
            testGameData.customerVisits = {};
            testGameData.shownRecipeStories = [];
            log(`ğŸ”„ æ‰€æœ‰è¿›åº¦å·²é‡ç½®`, 'info');
            updateCustomerDisplay();
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            log(`ğŸ® ç‰¹æ®Šé¡¾å®¢è§£é”æµç¨‹æµ‹è¯•é¡µé¢å·²è½½å…¥`, 'success');
            log(`ğŸ“Š ç³»ç»ŸåŒ…å« 9 ç§ç‰¹æ®Šé¡¾å®¢é…æ–¹è§£é”æœºåˆ¶`, 'info');
            log(`ğŸ¯ ç‚¹å‡»é¡¾å®¢å¡ç‰‡ä¸­çš„æŒ‰é’®å¼€å§‹æµ‹è¯•`, 'info');
            updateCustomerDisplay();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html> 